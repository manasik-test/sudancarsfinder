<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù†Ø¸Ø§Ù… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --success: #059669;
            --bg: #ffffff;
            --bg-light: #f8f9fa;
            --text-dark: #1f2937;
            --text-gray: #6b7280;
            --border: #e5e7eb;
            --facebook: #1877f2;
        }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Arial, sans-serif; 
            background: var(--bg-light);
            color: var(--text-dark);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 25px 20px;
            text-align: center;
        }
        
        .logo { font-size: 48px; margin-bottom: 10px; }
        .title { font-size: 22px; font-weight: bold; margin-bottom: 5px; }
        .subtitle { font-size: 14px; opacity: 0.9; }
        
        /* Stats */
        .stats {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; padding: 20px;
            background: white; margin: -20px 15px 0; border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1); position: relative; z-index: 1;
        }
        .stat { text-align: center; padding: 10px; }
        .stat-num { display: block; font-size: 28px; font-weight: bold; color: var(--primary); margin-bottom: 5px; }
        .stat-label { display: block; font-size: 12px; color: var(--text-gray); }
        
        /* Container */
        .container { max-width: 600px; margin: 0 auto; padding: 0 15px 20px; }
        
        /* Section */
        .section {
            background: white; border-radius: 15px; padding: 25px 20px; margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .section-title {
            font-size: 20px; font-weight: bold; color: var(--text-dark);
            margin-bottom: 20px; display: flex; align-items: center; gap: 10px;
        }
        
        /* Search Form */
        .search-type { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .type-btn {
            padding: 14px; background: var(--bg-light); border: 2px solid var(--border);
            border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer;
            transition: all 0.3s; text-align: center;
        }
        .type-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        
        .form-group { margin-bottom: 18px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px; color: var(--text-dark); }
        .form-input {
            width: 100%; padding: 14px; border: 2px solid var(--border);
            border-radius: 10px; font-size: 16px; transition: border 0.3s;
        }
        .form-input:focus { outline: none; border-color: var(--primary); }
        
        .helper-text { font-size: 13px; color: var(--text-gray); margin-top: 5px; }
        .helper-error { color: #dc2626; }
        .helper-success { color: var(--success); }
        
        /* Button */
        .btn {
            width: 100%; padding: 16px; background: var(--primary); color: white;
            border: none; border-radius: 10px; font-size: 18px; font-weight: bold;
            cursor: pointer; transition: all 0.3s; display: flex; align-items: center;
            justify-content: center; gap: 8px;
        }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { background: #cbd5e1; cursor: not-allowed; }
        .btn-secondary { background: var(--success); }

        /* Results Styling */
        .result { display: none; margin-top: 20px; padding: 10px; animation: slideIn 0.3s; }
        .result-not-found { background: #fff3cd; border: 2px solid #ffc107; padding: 20px; border-radius: 12px; }
        
        /* Popup Styling */
        .success-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 10000;
            align-items: center; justify-content: center; backdrop-filter: blur(5px);
        }
        .success-card {
            background: white; padding: 30px; border-radius: 20px; text-align: center;
            max-width: 90%; width: 350px;
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-top: 5px solid var(--success);
        }
        @keyframes popIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .gratitude-text { color: #059669; font-size: 22px; font-weight: bold; margin: 15px 0; }

        /* Loading */
        .loading { display: none; text-align: center; padding: 30px; }
        .spinner {
            width: 50px; height: 50px; margin: 0 auto 15px;
            border: 5px solid var(--bg-light); border-top: 5px solid var(--primary);
            border-radius: 50%; animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .loading-text { color: var(--text-gray); font-size: 15px; }

        /* Autocomplete */
        .autocomplete { position: relative; }
        .autocomplete-items {
            position: absolute; border: 2px solid var(--border); border-top: none;
            border-radius: 0 0 10px 10px; z-index: 99; top: 100%; left: 0; right: 0;
            max-height: 200px; overflow-y: auto; background: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }
        .autocomplete-items div { padding: 12px; cursor: pointer; border-bottom: 1px solid var(--bg-light); }
        .autocomplete-items div:hover { background-color: var(--bg-light); }
        
        /* Footer & FAQ */
        .footer { background: var(--text-dark); color: white; padding: 30px 20px 20px; margin-top: 30px; }
        .footer-content { max-width: 600px; margin: 0 auto; text-align: center; }
        .copyright { font-size: 13px; color: #9ca3af; margin-top: 20px; padding-top: 20px; border-top: 1px solid #374151; }
        
        .faq-item { border-bottom: 1px solid var(--border); padding: 15px 0; }
        .faq-question { display: flex; justify-content: space-between; cursor: pointer; font-weight: 600; }
        .faq-answer { max-height: 0; overflow: hidden; transition: max-height 0.3s ease; color: var(--text-gray); font-size: 14px; }
        .faq-item.active .faq-answer { max-height: 200px; padding-top: 10px; }
    </style>
</head>
<body>

<div class="header">
    <div class="logo">ğŸš—</div>
    <div class="title">Ù†Ø¸Ø§Ù… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©</div>
    <div class="subtitle">Ø§Ø¨Ø­Ø« Ø¹Ù† Ø³ÙŠØ§Ø±ØªÙƒ Ø¨Ø³Ù‡ÙˆÙ„Ø© ÙˆØ£Ù…Ø§Ù†</div>
</div>

<div class="stats">
    <div class="stat"><span class="stat-num">2.5K</span><span class="stat-label">Ù…ÙØ³ØªØ±Ø¬Ø¹</span></div>
    <div class="stat"><span class="stat-num">450</span><span class="stat-label">Ù†Ø´Ø·</span></div>
    <div class="stat"><span class="stat-num">92%</span><span class="stat-label">Ù†Ø¬Ø§Ø­</span></div>
</div>

<div class="container">
    <div class="section">
        <h2 class="section-title">ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø³ÙŠØ§Ø±ØªÙƒ</h2>
        
        <div class="search-type">
            <div class="type-btn active" onclick="setSearchType('chassis')">ğŸ”¢ Ø±Ù‚Ù… Ø´Ø§Ø³ÙŠ</div>
            <div class="type-btn" onclick="setSearchType('plate')">ğŸš— Ø±Ù‚Ù… Ù„ÙˆØ­Ø©</div>
        </div>
        
        <div class="form-group">
            <label class="form-label" id="numberLabel">Ø£Ø¯Ø®Ù„ Ø¢Ø®Ø± 4 Ø£Ø±Ù‚Ø§Ù… Ù…Ù† Ø§Ù„Ø´Ø§Ø³ÙŠ</label>
            <input type="text" class="form-input" id="numberInput" placeholder="1234" maxlength="4">
            <div class="helper-text helper-error" id="numberHelper">âš ï¸ ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ 4 Ø£Ø±Ù‚Ø§Ù… Ø¨Ø§Ù„Ø¶Ø¨Ø·</div>
        </div>
        
        <div class="form-group">
            <label class="form-label">Ø±Ù‚Ù… ØªÙ„ÙÙˆÙ†Ùƒ (Ù„Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ)</label>
            <input type="tel" class="form-input" id="phoneInput" placeholder="0912345678">
            <div class="helper-text">Ø¶Ø±ÙˆØ±ÙŠ Ø¬Ø¯Ø§Ù‹ Ù„Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ø¹Ù†Ø¯ Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</div>
        </div>
        
        <button class="btn" id="searchBtn" onclick="startSearch()" disabled>ğŸ” Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø­Ø«</button>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <div class="loading-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
        </div>
        
        <div class="result result-not-found" id="resultNotFound">
            <h3>ğŸ” Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù„Ù… ØªØ¸Ù‡Ø± Ø¨Ø¹Ø¯</h3>
            <p style="color: #856404; margin-bottom: 15px; font-size: 14px;">Ø³Ø§Ø¹Ø¯Ù†Ø§ Ø¨ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø³ÙŠØ§Ø±ØªÙƒ Ø¹Ø´Ø§Ù† Ù†Ø®Ø·Ø±Ùƒ ÙÙˆØ± Ø¸Ù‡ÙˆØ±Ù‡Ø§:</p>
            
            <div class="register-form">
                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ù…Ø§Ø±ÙƒØ©</label>
                    <div class="autocomplete">
                        <input type="text" class="form-input" id="brandInput" placeholder="Ø§Ø¨Ø¯Ø£ Ø§Ù„ÙƒØªØ§Ø¨Ø©... (Ù…Ø«Ø§Ù„: ØªÙˆÙŠÙˆØªØ§)">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</label>
                    <div class="autocomplete">
                        <input type="text" class="form-input" id="modelInput" placeholder="Ø§Ø¨Ø¯Ø£ Ø§Ù„ÙƒØªØ§Ø¨Ø©... (Ù…Ø«Ø§Ù„: ÙƒÙˆØ±ÙˆÙ„Ø§)">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ø´Ø§Ø³ÙŠ Ø§Ù„ÙƒØ§Ù…Ù„</label>
                    <input type="text" class="form-input" id="fullChassisInput" placeholder="Ø£Ø¯Ø®Ù„ Ø¢Ø®Ø± 6 Ø£Ø±Ù‚Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„" maxlength="17">
                </div>
                
                <button class="btn btn-secondary" onclick="registerRequest()">ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</button>
            </div>
        </div>
    </div>
    
    <div class="section">
        <h2 class="section-title">â“ Ø£Ø³Ø¦Ù„Ø© Ø´Ø§Ø¦Ø¹Ø©</h2>
        
        <div class="faq-item" onclick="toggleFaq(this)">
            <div class="faq-question"><span>Ù‡Ù„ Ø§Ù„Ø®Ø¯Ù…Ø© Ù…Ø¬Ø§Ù†ÙŠØ©ØŸ</span><span>â–¼</span></div>
            <div class="faq-answer">Ù†Ø¹Ù…ØŒ Ø§Ù„Ø®Ø¯Ù…Ø© Ù…Ø¬Ø§Ù†ÙŠØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙˆÙ„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙŠ Ø±Ø³ÙˆÙ… Ù…Ø®ÙÙŠØ©</div>
        </div>
        
        <div class="faq-item active" onclick="toggleFaq(this)">
            <div class="faq-question"><span>ÙƒÙ… ÙŠØ³ØªØºØ±Ù‚ Ø§Ù„Ø¨Ø­Ø«ØŸ</span><span>â–¼</span></div>
            <div class="faq-answer">Ø¹Ø§Ø¯Ø© 24-48 Ø³Ø§Ø¹Ø©ØŒ ÙˆØ³Ù†Ø®Ø·Ø±Ùƒ ÙÙˆØ±Ø§Ù‹ Ø¹Ù†Ø¯ Ø¸Ù‡ÙˆØ± Ø§Ù„Ø³ÙŠØ§Ø±Ø©</div>
        </div>
    </div>
    
    <div class="section">
        <div class="privacy-note">
            <span>ğŸ”’</span><span>Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù…Ø­Ù…ÙŠØ© ÙˆÙ…Ø´ÙØ±Ø© ÙˆÙ„Ù† Ù†Ø´Ø§Ø±ÙƒÙ‡Ø§ Ù…Ø¹ Ø£ÙŠ Ø¬Ù‡Ø©</span>
        </div>
    </div>
</div>

<div class="footer">
    <div class="footer-content">
        <div class="copyright">Â© 2026 Ù†Ø¸Ø§Ù… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø© - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</div>
    </div>
</div>

<div id="matchPopup" class="success-overlay">
    <div class="success-card">
        <div style="font-size: 60px; margin-bottom: 10px;">ğŸ¤²</div>
        <div class="gratitude-text">Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ Ø§Ù„Ø°ÙŠ Ø¬Ù…Ø¹</div>
        <p style="color: #4b5563; margin-bottom: 20px; font-size: 16px;">
            ÙˆØ¬Ø¯Ù†Ø§ Ø³ÙŠØ§Ø±Ø© ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!<br>
            Ø³Ù†ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ø¬Ø¯Ø§Ù‹ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…Ù„ÙƒÙŠØ©.
        </p>
        <button onclick="location.reload()" 
                style="background:#059669; color:white; border:none; padding:12px 40px; border-radius:10px; cursor:pointer; font-weight:bold; font-size:16px;">
            Ø­Ø³Ù†Ø§Ù‹
        </button>
    </div>
</div>

<div class="popup-overlay" id="successPopup">
    <div class="popup-box">
        <div style="font-size: 50px; margin-bottom: 15px;">âœ…</div>
        <h3 class="popup-title">ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!</h3>
        <p class="popup-message">Ø³Ù†Ø®Ø·Ø±Ùƒ ÙÙˆØ± Ø¸Ù‡ÙˆØ± Ø§Ù„Ø³ÙŠØ§Ø±Ø©</p>
        <button onclick="location.reload()" 
                style="background:#2563eb; color:white; border:none; padding:12px 30px; border-radius:10px; cursor:pointer; font-weight:bold;">
            Ø­Ø³Ù†Ø§Ù‹
        </button>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
// 1. Firebase Configuration
const firebaseConfig = {
    apiKey: "AIzaSyDvAx6-priGfzGLh2AlazSkIvsoc0OcW4Q",
    authDomain: "sudancarsrecover.firebaseapp.com",
    projectId: "sudancarsrecover",
    storageBucket: "sudancarsrecover.firebasestorage.app",
    messagingSenderId: "222129422162",
    appId: "1:222129422162:web:c3e8d3c498b53f96afc48b"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
db.enablePersistence({ synchronizeTabs: true }).catch(err => console.log(err));

// 2. Helper Functions
function convertArabicNums(str) {
    if (!str) return "";
    const a = ['Ù ','Ù¡','Ù¢','Ù£','Ù¤','Ù¥','Ù¦','Ù§','Ù¨','Ù©'];
    const e = ['0','1','2','3','4','5','6','7','8','9'];
    let r = str;
    for (let i = 0; i < 10; i++) r = r.replace(new RegExp(a[i], 'g'), e[i]);
    return r;
}

function toggleFaq(element) {
    const isActive = element.classList.contains('active');
    document.querySelectorAll('.faq-item').forEach(item => item.classList.remove('active'));
    if (!isActive) element.classList.add('active');
}

// 3. Global Variables
let searchType = 'chassis';
const brands = ["ØªÙˆÙŠÙˆØªØ§", "Ù‡ÙŠÙˆÙ†Ø¯Ø§ÙŠ", "ÙƒÙŠØ§", "Ù…ÙŠØªØ³ÙˆØ¨ÙŠØ´ÙŠ", "Ù†ÙŠØ³Ø§Ù†", "Ø³ÙˆØ²ÙˆÙƒÙŠ", "ÙÙˆÙ„ÙƒØ³ ÙØ§Ø¬Ù†", "Ù‡ÙˆÙ†Ø¯Ø§", "Ø³ÙƒÙˆØ¯Ø§", "Ø¨ÙŠ ÙˆØ§ÙŠ Ø¯ÙŠ", "Ù…Ø§Ø±ÙƒØ§Øª Ø£Ø®Ø±Ù‰"];
const models = ["ÙƒÙˆØ±ÙˆÙ„Ø§", "Ø§ÙƒØ³Ù†Øª", "ØªÙˆØ³Ø§Ù†", "Ù„Ø§Ù†Ø³Ø±", "ÙƒÙ„ÙŠÙƒ", "Ù…ÙˆØ±Ù†ÙŠÙ‚", "ØµÙ†ÙŠ", "Ø¨ÙˆÙƒØ³ÙŠ", "Ù‡Ø§ÙŠØ³", "Ø§ÙØ§Ù†ØªÙŠ"];

// 4. UI Interaction
function setSearchType(type) {
    searchType = type;
    document.querySelectorAll('.type-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    const numberInput = document.getElementById('numberInput');
    const numberLabel = document.getElementById('numberLabel');
    const helper = document.getElementById('numberHelper');
    
    numberInput.value = '';
    
    if (type === 'chassis') {
        numberLabel.textContent = 'Ø£Ø¯Ø®Ù„ Ø¢Ø®Ø± 4 Ø£Ø±Ù‚Ø§Ù… Ù…Ù† Ø§Ù„Ø´Ø§Ø³ÙŠ';
        numberInput.placeholder = '1234';
        numberInput.maxLength = 4;
        helper.textContent = 'âš ï¸ ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ 4 Ø£Ø±Ù‚Ø§Ù… Ø¨Ø§Ù„Ø¶Ø¨Ø·';
        helper.className = 'helper-text helper-error';
    } else {
        numberLabel.textContent = 'Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©';
        numberInput.placeholder = 'Ø£Ø¯Ø®Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·';
        numberInput.maxLength = 10;
        helper.textContent = 'ÙŠÙ…ÙƒÙ† Ø¥Ø¯Ø®Ø§Ù„ Ø£ÙŠ Ø¹Ø¯Ø¯ Ù…Ù† Ø§Ù„Ø£Ø±Ù‚Ø§Ù…';
        helper.className = 'helper-text';
    }
    document.getElementById('searchBtn').disabled = true;
}

// Input Validation
document.getElementById('numberInput').addEventListener('input', (e) => {
    const converted = convertArabicNums(e.target.value); 
    const value = converted.replace(/[^0-9]/g, '');
    e.target.value = value;
    
    const helper = document.getElementById('numberHelper');
    const btn = document.getElementById('searchBtn');
    
    if (searchType === 'chassis') {
        if (value.length < 4) {
            helper.textContent = `âš ï¸ ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ 4 Ø£Ø±Ù‚Ø§Ù… (ØªÙ… Ø¥Ø¯Ø®Ø§Ù„ ${value.length})`;
            helper.className = 'helper-text helper-error';
            btn.disabled = true;
        } else {
            helper.textContent = 'âœ… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø­Ø«';
            helper.className = 'helper-text helper-success';
            btn.disabled = false;
        }
    } else {
        btn.disabled = value.length === 0;
    }
});

// 5. Main Search Logic (Modified for Match Popup)
async function startSearch() {
    const number = document.getElementById('numberInput').value.trim();
    const phone = document.getElementById('phoneInput').value.trim();
    
    if (!number || !phone) return alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø§Ù„Ø±Ù‚Ù… ÙˆØ§Ù„Ù‡Ø§ØªÙ)');
    if (phone.length < 10) return alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙ ØµØ­ÙŠØ­');
    
    document.getElementById('resultNotFound').style.display = 'none';
    document.getElementById('loading').style.display = 'block';
    
    try {
        // Query found_cars
        const snapshot = await db.collection('found_cars').get();
        let matchedCar = null;
        let matchedDocId = null;
        
        // Find match in javascript (safer for suffixes)
        for (let doc of snapshot.docs) {
            const data = doc.data();
            const fullChassis = (data.chassis_full || data.chassis || "").toUpperCase();
            const plate = (data.plate || "").toUpperCase();
            
            if (fullChassis.endsWith(number.toUpperCase()) || (plate && plate.endsWith(number.toUpperCase()))) {
                matchedCar = data;
                matchedDocId = doc.id;
                break; // Stop at first match or collect all if preferred
            }
        }
        
        if (matchedCar) {
            // âœ… MATCH FOUND
            // 1. Add to Confirmed Matches for Admin
            await db.collection('confirmed_matches').add({
                user_phone: phone,
                search_number: number,
                match_type: searchType,
                found_car_id: matchedDocId,
                found_car_data: matchedCar,
                status: 'new', // Admin sees this as new match
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });

            // 2. Show Alhamdulillah Popup (No details shown to user)
            document.getElementById('matchPopup').style.display = 'flex';
            
        } else {
            // âŒ NO MATCH FOUND
            // Show registration form
            document.getElementById('resultNotFound').style.display = 'block';
            document.getElementById('fullChassisInput').value = number; // Auto-fill
        }
        
    } catch (error) {
        console.error("Error:", error);
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹");
    } finally {
        document.getElementById('loading').style.display = 'none';
    }
}

// 6. Auto-complete Logic
function setupAutocomplete(id, list) {
    const input = document.getElementById(id);
    if(!input) return;
    
    input.addEventListener('input', function() {
        const val = this.value;
        const container = this.parentNode;
        const old = container.querySelector('.autocomplete-items');
        if(old) old.remove();
        if(!val) return;
        
        const items = document.createElement('div');
        items.className = 'autocomplete-items';
        list.forEach(item => {
            if(item.substr(0, val.length).toUpperCase() === val.toUpperCase()) {
                const d = document.createElement('div');
                d.innerHTML = `<strong>${item.substr(0, val.length)}</strong>${item.substr(val.length)}`;
                d.addEventListener('click', function() {
                    input.value = item;
                    items.remove();
                });
                items.appendChild(d);
            }
        });
        container.appendChild(items);
    });
}
setupAutocomplete('brandInput', brands);
setupAutocomplete('modelInput', models);

// 7. Register Logic
async function registerRequest() {
    const brand = document.getElementById('brandInput').value;
    const model = document.getElementById('modelInput').value;
    const chassis = document.getElementById('fullChassisInput').value;
    const phone = document.getElementById('phoneInput').value;

    if(!brand || !chassis || !phone) return alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ ÙƒØ§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');

    try {
        await db.collection('missing_cars').add({
            brand, 
            model, 
            chassis_full: chassis, 
            chassis_suffix: chassis.slice(-4),
            owner_phone: phone,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        document.getElementById('successPopup').style.display = 'flex';
    } catch(e) {
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„');
        console.error(e);
    }
}
</script>

</body>
</html>
